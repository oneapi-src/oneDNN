
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>cpu_rnn_inference_f32.cpp &#8212; oneDNN v3.1.1 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/target-highlight.js"></script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">oneDNN v3.1.1 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="build_and_link.html">
   Building and Linking
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_build.html">
     Build from Source
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_build_options.html">
     Build Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_link.html">
     Linking to the Library
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="programming_model.html">
   Programming Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_basic_concepts.html">
     Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_getting_started_cpp.html">
     Getting started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_memory_format_propagation_cpp.html">
     Memory Format Propagation
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="dev_guide_inference_and_training_aspects.html">
     Inference and Training Aspects
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_inference.html">
       Inference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_inference_int8.html">
       Int8 Inference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_training_bf16.html">
       Bfloat16 Training
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="dev_guide_attributes.html">
     Primitive Attributes
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_fpmath_mode.html">
       Primitive Attributes: floating-point math mode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_quantization.html">
       Primitive Attributes: Quantization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_post_ops.html">
       Primitive Attributes: Post-ops
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_scratchpad.html">
       Primitive Attributes: Scratchpad
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_data_types.html">
     Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_cross_engine_reorder_cpp.html">
     Reorder between CPU and GPU engines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_c_and_cpp_apis.html">
     API
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="interop_with_dpcpp_and_opencl.html">
     Interoperability with DPC++ and OpenCL
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_opencl_interoperability.html">
       OpenCL Interoperability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_dpcpp_interoperability.html">
       DPC++ Interoperability
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="supported_primitives.html">
   Supported Primitives
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_convolution.html">
     Convolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_inner_product.html">
     Inner Product
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_matmul.html">
     Matrix Multiplication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_rnn.html">
     RNN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_batch_normalization.html">
     Batch Normalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_binary.html">
     Binary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_concat.html">
     Concat
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_eltwise.html">
     Eltwise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_layer_normalization.html">
     Layer Normalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_lrn.html">
     Local Response Normalization (LRN)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_pooling.html">
     Pooling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_prelu.html">
     PReLU
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_resampling.html">
     Resampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_shuffle.html">
     Shuffle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_softmax.html">
     Softmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_sum.html">
     Sum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_reorder.html">
     Reorder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_reduction.html">
     Reduction
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="graph_extension.html">
   Graph Extension
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="graph_programming_model.html">
     Programming Model
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_graph_basic_concepts.html">
       Basic Concepts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_graph_low_precision.html">
       Low Precision
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="graph_supported_operations.html">
     Supported Operations
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_abs.html">
       Abs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_absbackward.html">
       AbsBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_add.html">
       Add
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_avgpool.html">
       AvgPool
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_avgpoolbackward.html">
       AvgPoolBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_batchnormforwardtraining.html">
       BatchNormForwardTraining
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_batchnorminference.html">
       BatchNormInference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_batchnormtrainingbackward.html">
       BatchNormTrainingBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_biasadd.html">
       BiasAdd
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_biasaddbackward.html">
       BiasAddBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_clamp.html">
       Clamp
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_clampbackward.html">
       ClampBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_concat.html">
       Concat
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convolution.html">
       Convolution
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convolutionbackwarddata.html">
       ConvolutionBackwardData
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convolutionbackwardweights.html">
       ConvolutionBackwardWeights
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convtranspose.html">
       ConvTranspose
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convtransposebackwarddata.html">
       ConvTransposeBackwardData
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_convtransposebackwardweights.html">
       ConvTransposeBackwardWeights
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_dequantize.html">
       Dequantize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_divide.html">
       Divide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_dynamicdequantize.html">
       DynamicDequantize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_dynamicquantize.html">
       DynamicQuantize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_elu.html">
       Elu
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_elubackward.html">
       EluBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_end.html">
       End
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_exp.html">
       Exp
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_gelu.html">
       GELU
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_gelubackward.html">
       GELUBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_hardsigmoid.html">
       HardSigmoid
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_hardsigmoidbackward.html">
       HardSigmoidBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_hardswish.html">
       HardSwish
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_hardswishbackward.html">
       HardSwishBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_interpolate.html">
       Interpolate
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_interpolatebackward.html">
       InterpolateBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_layernorm.html">
       LayerNorm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_layernormbackward.html">
       LayerNormBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_leakyrelu.html">
       LeakyReLU
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_log.html">
       Log
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_logsoftmax.html">
       LogSoftmax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_logsoftmaxbackward.html">
       LogSoftmaxBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_matmul.html">
       MatMul
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_maximum.html">
       Maximum
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_maxpool.html">
       MaxPool
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_maxpoolbackward.html">
       MaxPoolBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_minimum.html">
       Minimum
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_mish.html">
       Mish
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_mishbackward.html">
       MishBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_multiply.html">
       Multiply
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_prelu.html">
       PReLU
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_prelubackward.html">
       PReLUBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_quantize.html">
       Quantize
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reciprocal.html">
       Reciprocal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducel1.html">
       ReduceL1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducel2.html">
       ReduceL2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducemax.html">
       ReduceMax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducemean.html">
       ReduceMean
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducemin.html">
       ReduceMin
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reduceprod.html">
       ReduceProd
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reducesum.html">
       ReduceSum
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_relu.html">
       ReLU
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_relubackward.html">
       ReLUBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_reorder.html">
       Reorder
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_round.html">
       Round
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_sigmoid.html">
       Sigmoid
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_sigmoidbackward.html">
       SigmoidBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_softmax.html">
       Softmax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_softmaxbackward.html">
       SoftmaxBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_softplus.html">
       SoftPlus
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_softplusbackward.html">
       SoftPlusBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_sqrt.html">
       Sqrt
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_sqrtbackward.html">
       SqrtBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_square.html">
       Square
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_squareddifference.html">
       SquaredDifference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_staticreshape.html">
       StaticReshape
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_statictranspose.html">
       StaticTranspose
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_subtract.html">
       Subtract
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_tanh.html">
       Tanh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_tanhbackward.html">
       TanhBackward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_typecast.html">
       TypeCast
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_op_wildcard.html">
       Wildcard
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_graph_fusion_patterns.html">
     Supported Fusion Patterns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_graph_dump.html">
     Graph Dump
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dev_guide_examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="performance_profiling_and_inspection.html">
   Performance Profiling and Inspection
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_verbose.html">
     Verbose Mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_performance_settings.html">
     Configuring oneDNN for Benchmarking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_benchdnn.html">
     Benchmarking Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_profilers.html">
     Profiling oneDNN Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_inspecting_jit.html">
     Inspecting JIT Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_performance_profiling_cpp.html">
     Performance Profiling Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_cpu_dispatcher_control.html">
     CPU Dispatcher Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_cpu_isa_hints.html">
     CPU ISA Hints
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="advanced_topics.html">
   Advanced Topics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_transition_to_dnnl.html">
     Transitioning from Intel MKL-DNN to oneDNN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_understanding_memory_formats.html">
     Understanding Memory Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_int8_computations.html">
     Nuances of int8 Computations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_primitive_cache.html">
     Primitive Cache
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_persistent_cache.html">
     Persistent Cache
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_threadpool.html">
     Using oneDNN with Threadpool-Based Threading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_experimental.html">
     Experimental features
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="group_dnnl_api.html">
   oneDNN API
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_primitives.html">
     Primitives
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_primitives_common.html">
       Common
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_alg_kind_t.html">
         enum dnnl_alg_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_normalization_flags_t.html">
         enum dnnl_normalization_flags_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_primitive_kind_t.html">
         enum dnnl_primitive_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_prop_kind_t.html">
         enum dnnl_prop_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_query_t.html">
         enum dnnl_query_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_normalization_flags.html">
         enum dnnl::normalization_flags
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_query.html">
         enum dnnl::query
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_exec_arg_t.html">
         struct dnnl_exec_arg_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive.html">
         struct dnnl_primitive
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc.html">
         struct dnnl_primitive_desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive-2.html">
         struct dnnl::primitive
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_primitive_kind.html">
           enum dnnl::primitive::kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc-2.html">
         struct dnnl::primitive_desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc_base.html">
         struct dnnl::primitive_desc_base
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_attributes.html">
       Attributes
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_algorithm.html">
         enum dnnl::algorithm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_scratchpad_mode_t.html">
         enum dnnl_scratchpad_mode_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_prop_kind.html">
         enum dnnl::prop_kind
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_scratchpad_mode.html">
         enum dnnl::scratchpad_mode
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_post_ops.html">
         struct dnnl_post_ops
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_attr.html">
         struct dnnl_primitive_attr
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_post_ops-2.html">
         struct dnnl::post_ops
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_attr-2.html">
         struct dnnl::primitive_attr
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_reorder.html">
       Reorder
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_reorder.html">
         struct dnnl::reorder
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html">
           struct dnnl::reorder::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_concat.html">
       Concat
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_concat.html">
         struct dnnl::concat
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_concat_primitive_desc.html">
           struct dnnl::concat::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_sum.html">
       Sum
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_sum.html">
         struct dnnl::sum
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_sum_primitive_desc.html">
           struct dnnl::sum::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_binary.html">
       Binary
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_binary.html">
         struct dnnl::binary
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_binary_primitive_desc.html">
           struct dnnl::binary::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_convolution.html">
       Convolution
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_backward_data.html">
         struct dnnl::convolution_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_data_primitive_desc.html">
           struct dnnl::convolution_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_backward_weights.html">
         struct dnnl::convolution_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_weights_primitive_desc.html">
           struct dnnl::convolution_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_forward.html">
         struct dnnl::convolution_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_forward_primitive_desc.html">
           struct dnnl::convolution_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_deconvolution.html">
       Deconvolution
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_backward_data.html">
         struct dnnl::deconvolution_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_data_primitive_desc.html">
           struct dnnl::deconvolution_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_backward_weights.html">
         struct dnnl::deconvolution_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_weights_primitive_desc.html">
           struct dnnl::deconvolution_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_forward.html">
         struct dnnl::deconvolution_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_forward_primitive_desc.html">
           struct dnnl::deconvolution_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_shuffle.html">
       Shuffle
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_shuffle_backward.html">
         struct dnnl::shuffle_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_backward_primitive_desc.html">
           struct dnnl::shuffle_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_shuffle_forward.html">
         struct dnnl::shuffle_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_forward_primitive_desc.html">
           struct dnnl::shuffle_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_eltwise.html">
       Eltwise
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_eltwise_backward.html">
         struct dnnl::eltwise_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_backward_primitive_desc.html">
           struct dnnl::eltwise_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_eltwise_forward.html">
         struct dnnl::eltwise_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_forward_primitive_desc.html">
           struct dnnl::eltwise_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_softmax.html">
       Softmax
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_backward.html">
         struct dnnl::softmax_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_backward_primitive_desc.html">
           struct dnnl::softmax_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_forward.html">
         struct dnnl::softmax_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_forward_primitive_desc.html">
           struct dnnl::softmax_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_pooling.html">
       Pooling
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_backward.html">
         struct dnnl::pooling_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_backward_primitive_desc.html">
           struct dnnl::pooling_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_forward.html">
         struct dnnl::pooling_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_forward_primitive_desc.html">
           struct dnnl::pooling_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_prelu.html">
       PReLU
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_prelu_backward.html">
         struct dnnl::prelu_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_backward_primitive_desc.html">
           struct dnnl::prelu_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_prelu_forward.html">
         struct dnnl::prelu_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_forward_primitive_desc.html">
           struct dnnl::prelu_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_lrn.html">
       LRN
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lrn_backward.html">
         struct dnnl::lrn_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_backward_primitive_desc.html">
           struct dnnl::lrn_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lrn_forward.html">
         struct dnnl::lrn_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_forward_primitive_desc.html">
           struct dnnl::lrn_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_batch_normalization.html">
       Batch Normalization
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_batch_normalization_backward.html">
         struct dnnl::batch_normalization_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_backward_primitive_desc.html">
           struct dnnl::batch_normalization_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_batch_normalization_forward.html">
         struct dnnl::batch_normalization_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_forward_primitive_desc.html">
           struct dnnl::batch_normalization_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_layer_normalization.html">
       Layer Normalization
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_layer_normalization_backward.html">
         struct dnnl::layer_normalization_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_backward_primitive_desc.html">
           struct dnnl::layer_normalization_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_layer_normalization_forward.html">
         struct dnnl::layer_normalization_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_forward_primitive_desc.html">
           struct dnnl::layer_normalization_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_inner_product.html">
       Inner Product
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_backward_data.html">
         struct dnnl::inner_product_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_data_primitive_desc.html">
           struct dnnl::inner_product_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_backward_weights.html">
         struct dnnl::inner_product_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_weights_primitive_desc.html">
           struct dnnl::inner_product_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_forward.html">
         struct dnnl::inner_product_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_forward_primitive_desc.html">
           struct dnnl::inner_product_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_rnn.html">
       RNN
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_direction_t.html">
         enum dnnl_rnn_direction_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_flags_t.html">
         enum dnnl_rnn_flags_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_direction.html">
         enum dnnl::rnn_direction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_flags.html">
         enum dnnl::rnn_flags
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_augru_backward.html">
         struct dnnl::augru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_backward_primitive_desc.html">
           struct dnnl::augru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_augru_forward.html">
         struct dnnl::augru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_forward_primitive_desc.html">
           struct dnnl::augru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_gru_backward.html">
         struct dnnl::gru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_backward_primitive_desc.html">
           struct dnnl::gru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_gru_forward.html">
         struct dnnl::gru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_forward_primitive_desc.html">
           struct dnnl::gru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_augru_backward.html">
         struct dnnl::lbr_augru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_backward_primitive_desc.html">
           struct dnnl::lbr_augru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_augru_forward.html">
         struct dnnl::lbr_augru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_forward_primitive_desc.html">
           struct dnnl::lbr_augru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_gru_backward.html">
         struct dnnl::lbr_gru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_backward_primitive_desc.html">
           struct dnnl::lbr_gru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_gru_forward.html">
         struct dnnl::lbr_gru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_forward_primitive_desc.html">
           struct dnnl::lbr_gru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lstm_backward.html">
         struct dnnl::lstm_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_backward_primitive_desc.html">
           struct dnnl::lstm_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lstm_forward.html">
         struct dnnl::lstm_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html">
           struct dnnl::lstm_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_rnn_primitive_desc_base.html">
         struct dnnl::rnn_primitive_desc_base
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_vanilla_rnn_backward.html">
         struct dnnl::vanilla_rnn_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_backward_primitive_desc.html">
           struct dnnl::vanilla_rnn_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_vanilla_rnn_forward.html">
         struct dnnl::vanilla_rnn_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_forward_primitive_desc.html">
           struct dnnl::vanilla_rnn_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_matmul.html">
       Matrix Multiplication
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_matmul.html">
         struct dnnl::matmul
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_matmul_primitive_desc.html">
           struct dnnl::matmul::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_resampling.html">
       Resampling
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_resampling_backward.html">
         struct dnnl::resampling_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_backward_primitive_desc.html">
           struct dnnl::resampling_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_resampling_forward.html">
         struct dnnl::resampling_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_forward_primitive_desc.html">
           struct dnnl::resampling_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_reduction.html">
       Reduction
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_reduction.html">
         struct dnnl::reduction
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_reduction_primitive_desc.html">
           struct dnnl::reduction::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_memory.html">
     Memory
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_format_kind_t.html">
       enum dnnl_format_kind_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_format_tag_t.html">
       enum dnnl_format_tag_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_sparse_encoding_t.html">
       enum dnnl_sparse_encoding_t
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory.html">
       struct dnnl_memory
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory_desc.html">
       struct dnnl_memory_desc
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory-2.html">
       struct dnnl::memory
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_data_type.html">
         enum dnnl::memory::data_type
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_format_kind.html">
         enum dnnl::memory::format_kind
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_format_tag.html">
         enum dnnl::memory::format_tag
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_sparse_encoding.html">
         enum dnnl::memory::sparse_encoding
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_memory_desc-2.html">
         struct dnnl::memory::desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_primitive_cache.html">
     Primitive Cache
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_blas.html">
     BLAS functions
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_common.html">
     Common API
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_engine.html">
       Engine
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_engine_kind_t.html">
         enum dnnl_engine_kind_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_engine.html">
         struct dnnl_engine
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_engine-2.html">
         struct dnnl::engine
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_engine_kind.html">
           enum dnnl::engine::kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_stream.html">
       Stream
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_stream_flags_t.html">
         enum dnnl_stream_flags_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_stream.html">
         struct dnnl_stream
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_stream-2.html">
         struct dnnl::stream
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_stream_flags.html">
           enum dnnl::stream::flags
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_fpmath_mode.html">
       Floating-point Math Mode
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_fpmath_mode_t.html">
         enum dnnl_fpmath_mode_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_fpmath_mode.html">
         enum dnnl::fpmath_mode
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_service.html">
       Service
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_cpu_isa.html">
         enum dnnl::cpu_isa
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_cpu_isa_hints.html">
         enum dnnl::cpu_isa_hints
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_cpu_isa_hints_t.html">
         enum dnnl_cpu_isa_hints_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_cpu_isa_t.html">
         enum dnnl_cpu_isa_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_status.html">
         enum dnnl::status
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_version_t.html">
         struct dnnl_version_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_utils.html">
       Utilities
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_status_t.html">
         enum dnnl_status_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_error.html">
         struct dnnl::error
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_handle.html">
         template struct dnnl::handle
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_handle_traits.html">
         template struct dnnl::handle_traits
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_data_types.html">
       Data types
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_data_type_t.html">
         enum dnnl_data_type_t
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_graph_api.html">
     Graph API
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_allocator.html">
       Allocator
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_allocator.html">
         class dnnl::graph::allocator
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_engine.html">
       Engine
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_logical_tensor.html">
       Logical Tensor
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_graph_layout_type_t.html">
         enum dnnl_graph_layout_type_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_graph_tensor_property_t.html">
         enum dnnl_graph_tensor_property_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_graph_logical_tensor_t.html">
         struct dnnl_graph_logical_tensor_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_logical_tensor.html">
         class dnnl::graph::logical_tensor
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_logical_tensor_data_type.html">
           enum dnnl::graph::logical_tensor::data_type
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_logical_tensor_layout_type.html">
           enum dnnl::graph::logical_tensor::layout_type
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_logical_tensor_property_type.html">
           enum dnnl::graph::logical_tensor::property_type
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_tensor.html">
       Tensor
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_tensor.html">
         class dnnl::graph::tensor
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_op.html">
       Op
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_graph_op_attr_t.html">
         enum dnnl_graph_op_attr_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_graph_op_kind_t.html">
         enum dnnl_graph_op_kind_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_op.html">
         class dnnl::graph::op
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_op_attr.html">
           enum dnnl::graph::op::attr
          </a>
         </li>
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_op_kind.html">
           enum dnnl::graph::op::kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_partition.html">
       Partition
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_graph_partition_policy_t.html">
         enum dnnl_graph_partition_policy_t
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_partition.html">
         class dnnl::graph::partition
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_graph_partition_policy.html">
           enum dnnl::graph::partition::policy
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_compiled_partition.html">
       Compiled Partition
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_graph_inplace_pair_t.html">
         struct dnnl_graph_inplace_pair_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_compiled_partition.html">
         class dnnl::graph::compiled_partition
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_graph.html">
       Graph
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="class_dnnl_graph_graph.html">
         class dnnl::graph::graph
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_compiled_partition_cache.html">
       Compiled Partition Cache
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_constant_tensor_cache.html">
       Constant Tensor Cache
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_graph_api_interop.html">
       Runtime interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="group_dnnl_graph_api_sycl_interop.html">
         SYCL interoperability API
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="namespace_dnnl_graph_sycl_interop.html">
           namespace dnnl::graph::sycl_interop
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="namespace_dnnl.html">
       namespace dnnl
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_graph.html">
         namespace dnnl::graph
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_interop.html">
     Runtime interoperability API
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_ocl_interop.html">
       OpenCL interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_ocl_interop.html">
         namespace dnnl::ocl_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_ocl_interop_memory_kind.html">
           enum dnnl::ocl_interop::memory_kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_ocl_interop_memory_kind_t.html">
         enum dnnl_ocl_interop_memory_kind_t
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_sycl_interop.html">
       SYCL interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_sycl_interop.html">
         namespace dnnl::sycl_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_sycl_interop_memory_kind.html">
           enum dnnl::sycl_interop::memory_kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_sycl_interop_memory_kind_t.html">
         enum dnnl_sycl_interop_memory_kind_t
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_threadpool_interop.html">
       Threadpool interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_threadpool_interop.html">
         namespace dnnl::threadpool_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_threadpool_interop_threadpool_iface.html">
           struct dnnl::threadpool_interop::threadpool_iface
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="namespace_oneapi.html">
     namespace oneapi
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/example_cpu_rnn_inference_f32.cpp.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="cpu-rnn-inference-f32-cpp">
<span id="doxid-cpu-rnn-inference-f32-8cpp-example"></span><span id="index-0"></span><h1>cpu_rnn_inference_f32.cpp<a class="headerlink" href="#cpu-rnn-inference-f32-cpp" title="Permalink to this headline">¶</a></h1>
<p>This C++ API example demonstrates how to build GNMT model inference. Annotated version: <a class="reference internal" href="page_cpu_rnn_inference_f32_cpp.html#doxid-cpu-rnn-inference-f32-cpp"><span class="std std-ref">RNN f32 inference example</span></a></p>
<p>This C++ API example demonstrates how to build GNMT model inference. Annotated version: <a class="reference internal" href="page_cpu_rnn_inference_f32_cpp.html#doxid-cpu-rnn-inference-f32-cpp"><span class="std std-ref">RNN f32 inference example</span></a></p>
<pre class="highlight literal-block"><span></span><span class="cm">/*******************************************************************************</span>
<span class="cm">* Copyright 2018-2022 Intel Corporation</span>
<span class="cm">*</span>
<span class="cm">* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm">* you may not use this file except in compliance with the License.</span>
<span class="cm">* You may obtain a copy of the License at</span>
<span class="cm">*</span>
<span class="cm">*     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm">*</span>
<span class="cm">* Unless required by applicable law or agreed to in writing, software</span>
<span class="cm">* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm">* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm">* See the License for the specific language governing permissions and</span>
<span class="cm">* limitations under the License.</span>
<span class="cm">*******************************************************************************/</span>



<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span>

<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span>
<span class="cp">#include</span> <span class="cpf">&lt;numeric&gt;</span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span>

<span class="cp">#include</span> <span class="cpf">&quot;oneapi/dnnl/dnnl.hpp&quot;</span>

<span class="cp">#include</span> <span class="cpf">&quot;example_utils.hpp&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_dnnl.html#doxid-namespacednnl"><span class="std std-ref">dnnl</span></a><span></span><span class="p">;</span>

<span class="k">using</span> <span class="n">dim_t</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a6ad818e4699872cc913474fa5f122cd5"><span class="std std-ref">dnnl::memory::dim</span></a><span></span><span class="p">;</span>

<span class="k">const</span> <span class="n">dim_t</span> <span class="n">batch</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
<span class="k">const</span> <span class="n">dim_t</span> <span class="n">src_seq_length_max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">const</span> <span class="n">dim_t</span> <span class="n">tgt_seq_length_max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="k">const</span> <span class="n">dim_t</span> <span class="n">feature_size</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>

<span class="k">const</span> <span class="n">dim_t</span> <span class="n">enc_bidir_n_layers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="n">dim_t</span> <span class="n">enc_unidir_n_layers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="n">dim_t</span> <span class="n">dec_n_layers</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">lstm_n_gates</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">weighted_src_layer</span><span class="p">(</span><span class="n">batch</span> <span class="o">*</span><span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">alignment_model</span><span class="p">(</span>
        <span class="n">src_seq_length_max</span> <span class="o">*</span><span class="n">batch</span> <span class="o">*</span><span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">alignments</span><span class="p">(</span><span class="n">src_seq_length_max</span> <span class="o">*</span><span class="n">batch</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">exp_sums</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">compute_weighted_annotations</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">weighted_annotations</span><span class="p">,</span>
        <span class="n">dim_t</span> <span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">feature_size</span><span class="p">,</span>
        <span class="kt">float</span> <span class="o">*</span><span class="n">weights_annot</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">annotations</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// annotations(aka enc_dst_layer) is (t, n, 2c)</span>
    <span class="c1">// weights_annot is (2c, c)</span>

    <span class="c1">// annotation[i] = GEMM(weights_annot, enc_dst_layer[i]);</span>
    <span class="n">dim_t</span> <span class="n">num_weighted_annotations</span> <span class="o">=</span> <span class="n">src_seq_length_max</span> <span class="o">*</span> <span class="n">batch</span><span class="p">;</span>
    <a class="reference internal" href="group_dnnl_api_blas.html#doxid-group-dnnl-api-blas-1ga75ee119765bdac249200fda42c0617f8"><span class="std std-ref">dnnl_sgemm</span></a><span></span><span class="p">(</span><span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="n">num_weighted_annotations</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.f</span><span class="p">,</span> <span class="n">annotations</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">weights_annot</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span>
            <span class="n">weighted_annotations</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">compute_attention</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">context_vectors</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">src_seq_length_max</span><span class="p">,</span>
        <span class="n">dim_t</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">feature_size</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">weights_src_layer</span><span class="p">,</span>
        <span class="kt">float</span> <span class="o">*</span><span class="n">dec_src_layer</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">annotations</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">weighted_annotations</span><span class="p">,</span>
        <span class="kt">float</span> <span class="o">*</span><span class="n">weights_alignments</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// dst_iter : (n, c) matrix</span>
    <span class="c1">// src_layer: (n, c) matrix</span>
    <span class="c1">// weighted_annotations (t, n, c)</span>

    <span class="c1">// weights_yi is (c, c)</span>
    <span class="c1">// weights_ai is (c, 1)</span>
    <span class="c1">// tmp[i] is (n, c)</span>
    <span class="c1">// a[i] is (n, 1)</span>
    <span class="c1">// p is (n, 1)</span>

    <span class="c1">// first we precompute the weighted_dec_src_layer</span>
    <a class="reference internal" href="group_dnnl_api_blas.html#doxid-group-dnnl-api-blas-1ga75ee119765bdac249200fda42c0617f8"><span class="std std-ref">dnnl_sgemm</span></a><span></span><span class="p">(</span><span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">,</span> <span class="n">dec_src_layer</span><span class="p">,</span>
            <span class="n">feature_size</span><span class="p">,</span> <span class="n">weights_src_layer</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span>
            <span class="n">weighted_src_layer</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">feature_size</span><span class="p">);</span>

    <span class="c1">// then we compute the alignment model</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">alignment_model_ptr</span> <span class="o">=</span> <span class="n">alignment_model</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>

    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src_seq_length_max</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">alignment_model_ptr</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tanhf</span><span class="p">(</span>
                    <span class="n">weighted_src_layer</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">weighted_annotations</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// gemv with alignments weights. the resulting alignments are in alignments</span>
    <span class="n">dim_t</span> <span class="n">num_weighted_annotations</span> <span class="o">=</span> <span class="n">src_seq_length_max</span> <span class="o">*</span> <span class="n">batch</span><span class="p">;</span>
    <a class="reference internal" href="group_dnnl_api_blas.html#doxid-group-dnnl-api-blas-1ga75ee119765bdac249200fda42c0617f8"><span class="std std-ref">dnnl_sgemm</span></a><span></span><span class="p">(</span><span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="n">num_weighted_annotations</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">,</span>
            <span class="n">alignment_model_ptr</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">weights_alignments</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span>
            <span class="n">alignments</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// softmax on alignments. the resulting context weights are in alignments</span>
    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">exp_sums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src_seq_length_max</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">alignments</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">expf</span><span class="p">(</span><span class="n">alignments</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
            <span class="n">exp_sums</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alignments</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src_seq_length_max</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">alignments</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">/=</span> <span class="n">exp_sums</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>

    <span class="c1">// then we compute the context vectors</span>
    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">feature_size</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">context_vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">feature_size</span>
                    <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">feature_size</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">src_seq_length_max</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
                <span class="n">context_vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">feature_size</span>
                        <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">+=</span> <span class="n">alignments</span><span class="p">[</span><span class="n">k</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                        <span class="o">*</span> <span class="n">annotations</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">k</span><span class="p">)];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">copy_context</span><span class="p">(</span>
        <span class="kt">float</span> <span class="o">*</span><span class="n">src_iter</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">batch</span><span class="p">,</span> <span class="n">dim_t</span> <span class="n">feature_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// we copy the context from the first layer to all other layers</span>
    <span class="n">PRAGMA_OMP_PARALLEL_FOR_COLLAPSE</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n_layers</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">batch</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">feature_size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="n">src_iter</span><span class="p">[(</span><span class="n">k</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">feature_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
                        <span class="o">=</span> <span class="n">src_iter</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">)</span>
                                <span class="o">+</span> <span class="n">feature_size</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">simple_net</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//[Initialize engine and stream]</span>
    <span class="k">auto</span> <span class="n">cpu_engine</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_engine-2.html#doxid-structdnnl-1-1engine"><span class="std std-ref">engine</span></a><span></span><span class="p">(</span><a class="reference internal" href="enum_dnnl_engine_kind.html#doxid-structdnnl-1-1engine-1a2635da16314dcbdb9bd9ea431316bb1aad9747e2da342bdb995f6389533ad1a3d"><span class="std std-ref">engine::kind::cpu</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_stream-2.html#doxid-structdnnl-1-1stream"><span class="std std-ref">stream</span></a><span></span> <span class="n">s</span><span class="p">(</span><span class="n">cpu_engine</span><span class="p">);</span>
    <span class="c1">//[Initialize engine and stream]</span>
    <span class="c1">//[declare net]</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">primitive</span><span class="o">&gt;</span> <span class="n">encoder_net</span><span class="p">,</span> <span class="n">decoder_net</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">memory</span><span class="o">&gt;&gt;</span> <span class="n">encoder_net_args</span><span class="p">,</span>
            <span class="n">decoder_net_args</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">net_src</span><span class="p">(</span><span class="n">batch</span> <span class="o">*</span> <span class="n">src_seq_length_max</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">net_dst</span><span class="p">(</span><span class="n">batch</span> <span class="o">*</span> <span class="n">tgt_seq_length_max</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="c1">//[declare net]</span>
    <span class="c1">//[Initialize encoder memory]</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_bidir_src_layer_tz</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_bidir_weights_layer_tz</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">enc_bidir_n_layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_bidir_weights_iter_tz</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">enc_bidir_n_layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_bidir_bias_tz</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">enc_bidir_n_layers</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_bidir_dst_layer_tz</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">};</span>
    <span class="c1">//[Initialize encoder memory]</span>


    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_bidir_wei_layer</span><span class="p">(</span>
            <span class="n">enc_bidir_n_layers</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_bidir_wei_iter</span><span class="p">(</span>
            <span class="n">enc_bidir_n_layers</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_bidir_bias</span><span class="p">(</span>
            <span class="n">enc_bidir_n_layers</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="c1">//[data memory creation]</span>
    <span class="k">auto</span> <span class="n">user_enc_bidir_src_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">enc_bidir_src_layer_tz</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fac775cf954921a129a65eb929476de911"><span class="std std-ref">dnnl::memory::format_tag::tnc</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">user_enc_bidir_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">enc_bidir_weights_layer_tz</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">user_enc_bidir_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">enc_bidir_weights_iter_tz</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">user_enc_bidir_bias_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_bidir_bias_tz</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab8690cd92ccee6a0ad55faccc0346aab"><span class="std std-ref">dnnl::memory::format_tag::ldgo</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">user_enc_bidir_src_layer_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_bidir_src_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">net_src</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_bidir_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_bidir_wei_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span>
                    <span class="n">user_enc_bidir_wei_layer</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_bidir_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_bidir_wei_iter_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span>
                    <span class="n">user_enc_bidir_wei_iter</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_bidir_bias_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_bidir_bias_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_enc_bidir_bias</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

    <span class="c1">//[data memory creation]</span>
    <span class="c1">//[memory desc for RNN data]</span>
    <span class="k">auto</span> <span class="n">enc_bidir_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_bidir_weights_layer_tz</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_bidir_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_bidir_weights_iter_tz</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_bidir_dst_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_bidir_dst_layer_tz</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="c1">//[memory desc for RNN data]</span>
    <span class="c1">//[create rnn]</span>

    <span class="k">auto</span> <span class="n">enc_bidir_prim_desc</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html#doxid-structdnnl-1-1lstm-forward-1-1primitive-desc"><span class="std std-ref">lstm_forward::primitive_desc</span></a><span></span><span class="p">(</span><span class="n">cpu_engine</span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_prop_kind.html#doxid-group-dnnl-api-attributes-1ggac7db48f6583aa9903e54c2a39d65438fa3b9fad4f80d45368f856b5403198ac4c"><span class="std std-ref">prop_kind::forward_inference</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_rnn_direction.html#doxid-group-dnnl-api-rnn-1gga33315cf335d1cbe26fd6b70d956e23d5a7a1bb9f8699e8c03cbe4bd681fb50830"><span class="std std-ref">rnn_direction::bidirectional_concat</span></a><span></span><span class="p">,</span>
            <span class="n">user_enc_bidir_src_layer_md</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span>
            <span class="n">enc_bidir_wei_layer_md</span><span class="p">,</span> <span class="n">enc_bidir_wei_iter_md</span><span class="p">,</span>
            <span class="n">user_enc_bidir_bias_md</span><span class="p">,</span> <span class="n">enc_bidir_dst_layer_md</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span>
            <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">());</span>
    <span class="c1">//[create rnn]</span>

    <span class="c1">//[reorder input data]</span>
    <span class="k">auto</span> <span class="n">enc_bidir_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_prim_desc</span><span class="p">.</span><span class="n">weights_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_bidir_wei_layer_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_bidir_wei_layer_memory</span><span class="p">,</span> <span class="n">enc_bidir_wei_layer_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_wei_layer_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_enc_bidir_wei_layer_memory</span><span class="p">,</span>
                    <span class="n">enc_bidir_wei_layer_memory</span><span class="p">);</span>
    <span class="c1">//[reorder input data]</span>

    <span class="k">auto</span> <span class="n">enc_bidir_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_prim_desc</span><span class="p">.</span><span class="n">weights_iter_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_bidir_wei_iter_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_bidir_wei_iter_memory</span><span class="p">,</span> <span class="n">enc_bidir_wei_iter_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_wei_iter_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_enc_bidir_wei_iter_memory</span><span class="p">,</span>
                    <span class="n">enc_bidir_wei_iter_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_bidir_dst_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_prim_desc</span><span class="p">.</span><span class="n">dst_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>

    <span class="c1">//[push bi rnn to encoder net]</span>
    <span class="n">encoder_net</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_lstm_forward.html#doxid-structdnnl-1-1lstm-forward"><span class="std std-ref">lstm_forward</span></a><span></span><span class="p">(</span><span class="n">enc_bidir_prim_desc</span><span class="p">));</span>
    <span class="n">encoder_net_args</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="p">{{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gab91ce4d04cf4e98e3a407daa0676764f"><span class="std std-ref">DNNL_ARG_SRC_LAYER</span></a><span></span><span class="p">,</span> <span class="n">user_enc_bidir_src_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga1ac9e1f1327be3902b488b64bae1b4c5"><span class="std std-ref">DNNL_ARG_WEIGHTS_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_bidir_wei_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga5a9c39486c01ad263e29677a32735af8"><span class="std std-ref">DNNL_ARG_WEIGHTS_ITER</span></a><span></span><span class="p">,</span> <span class="n">enc_bidir_wei_iter_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad0cbc09942aba93fbe3c0c2e09166f0d"><span class="std std-ref">DNNL_ARG_BIAS</span></a><span></span><span class="p">,</span> <span class="n">user_enc_bidir_bias_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gacfc123a6a4ff3b4af4cd27ed66fb8528"><span class="std std-ref">DNNL_ARG_DST_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_bidir_dst_layer_memory</span><span class="p">}});</span>
    <span class="c1">//[push bi rnn to encoder net]</span>

    <span class="c1">//[first uni layer]</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_first_wei_layer</span><span class="p">(</span>
            <span class="mi">1</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_first_wei_iter</span><span class="p">(</span>
            <span class="mi">1</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_first_bias</span><span class="p">(</span>
            <span class="mi">1</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="c1">//[first uni layer]</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_first_wei_layer_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_first_wei_iter_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_first_bias_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_uni_first_dst_layer_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">user_enc_uni_first_wei_layer_dims</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">user_enc_uni_first_wei_iter_dims</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_bias_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">user_enc_uni_first_bias_dims</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab8690cd92ccee6a0ad55faccc0346aab"><span class="std std-ref">dnnl::memory::format_tag::ldgo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_uni_first_wei_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span>
                    <span class="n">user_enc_uni_first_wei_layer</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_uni_first_wei_iter_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span>
                    <span class="n">user_enc_uni_first_wei_iter</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_first_bias_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_uni_first_bias_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span>
                    <span class="n">user_enc_uni_first_bias</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

    <span class="k">auto</span> <span class="n">enc_uni_first_wei_layer_md</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_enc_uni_first_wei_layer_dims</span><span class="p">},</span>
                    <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_wei_iter_md</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_enc_uni_first_wei_iter_dims</span><span class="p">},</span>
                    <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_dst_layer_md</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_uni_first_dst_layer_dims</span><span class="p">},</span>
                    <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="c1">// TODO: add support for residual connections</span>
    <span class="c1">// should it be a set residual in pd or a field to set manually?</span>
    <span class="c1">// should be an integer to specify at which layer to start</span>
    <span class="c1">//[create uni first]</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_prim_desc</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html#doxid-structdnnl-1-1lstm-forward-1-1primitive-desc"><span class="std std-ref">lstm_forward::primitive_desc</span></a><span></span><span class="p">(</span><span class="n">cpu_engine</span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_prop_kind.html#doxid-group-dnnl-api-attributes-1ggac7db48f6583aa9903e54c2a39d65438fa3b9fad4f80d45368f856b5403198ac4c"><span class="std std-ref">prop_kind::forward_inference</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_rnn_direction.html#doxid-group-dnnl-api-rnn-1gga33315cf335d1cbe26fd6b70d956e23d5a04f4bf4bc6a47e30f0353597e244c44a"><span class="std std-ref">rnn_direction::unidirectional_left2right</span></a><span></span><span class="p">,</span> <span class="n">enc_bidir_dst_layer_md</span><span class="p">,</span>
            <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <span class="n">enc_uni_first_wei_layer_md</span><span class="p">,</span>
            <span class="n">enc_uni_first_wei_iter_md</span><span class="p">,</span> <span class="n">user_enc_uni_first_bias_md</span><span class="p">,</span>
            <span class="n">enc_uni_first_dst_layer_md</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">());</span>

    <span class="c1">//[create uni first]</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_uni_first_prim_desc</span><span class="p">.</span><span class="n">weights_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_wei_layer_reorder_pd</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span><span class="n">user_enc_uni_first_wei_layer_memory</span><span class="p">,</span>
                    <span class="n">enc_uni_first_wei_layer_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_uni_first_wei_layer_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_enc_uni_first_wei_layer_memory</span><span class="p">,</span>
                    <span class="n">enc_uni_first_wei_layer_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_uni_first_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_uni_first_prim_desc</span><span class="p">.</span><span class="n">weights_iter_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_first_wei_iter_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_uni_first_wei_iter_memory</span><span class="p">,</span> <span class="n">enc_uni_first_wei_iter_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_uni_first_wei_iter_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_enc_uni_first_wei_iter_memory</span><span class="p">,</span>
                    <span class="n">enc_uni_first_wei_iter_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_uni_first_dst_layer_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">enc_uni_first_prim_desc</span><span class="p">.</span><span class="n">dst_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>

    <span class="c1">//[push first uni rnn to encoder net]</span>
    <span class="c1">// TODO: add a reorder when they will be available</span>
    <span class="n">encoder_net</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_lstm_forward.html#doxid-structdnnl-1-1lstm-forward"><span class="std std-ref">lstm_forward</span></a><span></span><span class="p">(</span><span class="n">enc_uni_first_prim_desc</span><span class="p">));</span>
    <span class="n">encoder_net_args</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="p">{{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gab91ce4d04cf4e98e3a407daa0676764f"><span class="std std-ref">DNNL_ARG_SRC_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_bidir_dst_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga1ac9e1f1327be3902b488b64bae1b4c5"><span class="std std-ref">DNNL_ARG_WEIGHTS_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_first_wei_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga5a9c39486c01ad263e29677a32735af8"><span class="std std-ref">DNNL_ARG_WEIGHTS_ITER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_first_wei_iter_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad0cbc09942aba93fbe3c0c2e09166f0d"><span class="std std-ref">DNNL_ARG_BIAS</span></a><span></span><span class="p">,</span> <span class="n">user_enc_uni_first_bias_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gacfc123a6a4ff3b4af4cd27ed66fb8528"><span class="std std-ref">DNNL_ARG_DST_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_first_dst_layer_memory</span><span class="p">}});</span>
    <span class="c1">//[push first uni rnn to encoder net]</span>

    <span class="c1">//[remaining uni layers]</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_wei_layer</span><span class="p">((</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
                    <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_wei_iter</span><span class="p">((</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
                    <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_enc_uni_bias</span><span class="p">(</span>
            <span class="p">(</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="c1">//[remaining uni layers]</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_wei_layer_dims</span> <span class="o">=</span> <span class="p">{(</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_wei_iter_dims</span> <span class="o">=</span> <span class="p">{(</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_enc_uni_bias_dims</span>
            <span class="o">=</span> <span class="p">{(</span><span class="n">enc_unidir_n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">enc_dst_layer_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">user_enc_uni_wei_layer_dims</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">(</span>
            <span class="p">{</span><span class="n">user_enc_uni_wei_iter_dims</span><span class="p">},</span> <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_bias_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_enc_uni_bias_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab8690cd92ccee6a0ad55faccc0346aab"><span class="std std-ref">dnnl::memory::format_tag::ldgo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_wei_layer_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_enc_uni_wei_layer_md</span><span class="p">,</span>
            <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_enc_uni_wei_layer</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_wei_iter_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_uni_wei_iter_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_enc_uni_wei_iter</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_enc_uni_bias_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_uni_bias_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_enc_uni_bias</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

    <span class="k">auto</span> <span class="n">enc_uni_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_enc_uni_wei_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_enc_uni_wei_iter_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_dst_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">({</span><span class="n">enc_dst_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="c1">// TODO: add support for residual connections</span>
    <span class="c1">// should it be a set residual in pd or a field to set manually?</span>
    <span class="c1">// should be an integer to specify at which layer to start</span>
    <span class="c1">//[create uni rnn]</span>
    <span class="k">auto</span> <span class="n">enc_uni_prim_desc</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html#doxid-structdnnl-1-1lstm-forward-1-1primitive-desc"><span class="std std-ref">lstm_forward::primitive_desc</span></a><span></span><span class="p">(</span><span class="n">cpu_engine</span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_prop_kind.html#doxid-group-dnnl-api-attributes-1ggac7db48f6583aa9903e54c2a39d65438fa3b9fad4f80d45368f856b5403198ac4c"><span class="std std-ref">prop_kind::forward_inference</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_rnn_direction.html#doxid-group-dnnl-api-rnn-1gga33315cf335d1cbe26fd6b70d956e23d5a04f4bf4bc6a47e30f0353597e244c44a"><span class="std std-ref">rnn_direction::unidirectional_left2right</span></a><span></span><span class="p">,</span>
            <span class="n">enc_uni_first_dst_layer_md</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span>
            <span class="n">enc_uni_wei_layer_md</span><span class="p">,</span> <span class="n">enc_uni_wei_iter_md</span><span class="p">,</span> <span class="n">user_enc_uni_bias_md</span><span class="p">,</span>
            <span class="n">enc_dst_layer_md</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">(),</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">memory::desc</span></a><span></span><span class="p">());</span>
    <span class="c1">//[create uni rnn]</span>

    <span class="k">auto</span> <span class="n">enc_uni_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_uni_prim_desc</span><span class="p">.</span><span class="n">weights_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_wei_layer_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_uni_wei_layer_memory</span><span class="p">,</span> <span class="n">enc_uni_wei_layer_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_uni_wei_layer_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span>
                    <span class="n">s</span><span class="p">,</span> <span class="n">user_enc_uni_wei_layer_memory</span><span class="p">,</span> <span class="n">enc_uni_wei_layer_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_uni_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">enc_uni_prim_desc</span><span class="p">.</span><span class="n">weights_iter_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">enc_uni_wei_iter_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_enc_uni_wei_iter_memory</span><span class="p">,</span> <span class="n">enc_uni_wei_iter_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">enc_uni_wei_iter_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_enc_uni_wei_iter_memory</span><span class="p">,</span> <span class="n">enc_uni_wei_iter_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">enc_dst_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">enc_uni_prim_desc</span><span class="p">.</span><span class="n">dst_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>

    <span class="c1">// TODO: add a reorder when they will be available</span>
    <span class="c1">//[push uni rnn to encoder net]</span>
    <span class="n">encoder_net</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_lstm_forward.html#doxid-structdnnl-1-1lstm-forward"><span class="std std-ref">lstm_forward</span></a><span></span><span class="p">(</span><span class="n">enc_uni_prim_desc</span><span class="p">));</span>
    <span class="n">encoder_net_args</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="p">{{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gab91ce4d04cf4e98e3a407daa0676764f"><span class="std std-ref">DNNL_ARG_SRC_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_first_dst_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga1ac9e1f1327be3902b488b64bae1b4c5"><span class="std std-ref">DNNL_ARG_WEIGHTS_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_wei_layer_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga5a9c39486c01ad263e29677a32735af8"><span class="std std-ref">DNNL_ARG_WEIGHTS_ITER</span></a><span></span><span class="p">,</span> <span class="n">enc_uni_wei_iter_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad0cbc09942aba93fbe3c0c2e09166f0d"><span class="std std-ref">DNNL_ARG_BIAS</span></a><span></span><span class="p">,</span> <span class="n">user_enc_uni_bias_memory</span><span class="p">},</span>
                    <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gacfc123a6a4ff3b4af4cd27ed66fb8528"><span class="std std-ref">DNNL_ARG_DST_LAYER</span></a><span></span><span class="p">,</span> <span class="n">enc_dst_layer_memory</span><span class="p">}});</span>
    <span class="c1">//[push uni rnn to encoder net]</span>
    <span class="c1">//[dec mem dim]</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_dec_wei_layer</span><span class="p">(</span>
            <span class="n">dec_n_layers</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">feature_size</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_dec_wei_iter</span><span class="p">(</span><span class="n">dec_n_layers</span> <span class="o">*</span> <span class="mi">1</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">lstm_n_gates</span>
                    <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span>
            <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_dec_bias</span><span class="p">(</span>
            <span class="n">dec_n_layers</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">lstm_n_gates</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_dec_dst</span><span class="p">(</span>
            <span class="n">tgt_seq_length_max</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_weights_attention_src_layer</span><span class="p">(</span>
            <span class="n">feature_size</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_weights_annotation</span><span class="p">(</span>
            <span class="n">feature_size</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">user_weights_alignments</span><span class="p">(</span><span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_dec_wei_layer_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_dec_wei_iter_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">user_dec_bias_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lstm_n_gates</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>

    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">dec_src_layer_dims</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">dec_dst_layer_dims</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">dec_dst_iter_c_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <span class="c1">//[dec mem dim]</span>

    <span class="c1">//[noctx mem dim]</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">dec_dst_iter_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span> <span class="o">+</span> <span class="n">feature_size</span><span class="p">};</span>
    <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1afdd20764d58c0b517d5a31276672aeb8"><span class="std std-ref">memory::dims</span></a><span></span> <span class="n">dec_dst_iter_noctx_dims</span>
            <span class="o">=</span> <span class="p">{</span><span class="n">dec_n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">};</span>
    <span class="c1">//[noctx mem dim]</span>

    <span class="c1">//[dec mem desc]</span>
    <span class="k">auto</span> <span class="n">user_dec_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_dec_wei_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_dec_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_dec_wei_iter_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa4e62e330c56963f9ead98490cd57ef7b"><span class="std std-ref">dnnl::memory::format_tag::ldigo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">user_dec_bias_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_dec_bias_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab8690cd92ccee6a0ad55faccc0346aab"><span class="std std-ref">dnnl::memory::format_tag::ldgo</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_dst_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">dec_dst_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fac775cf954921a129a65eb929476de911"><span class="std std-ref">dnnl::memory::format_tag::tnc</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_src_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">dec_src_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fac775cf954921a129a65eb929476de911"><span class="std std-ref">dnnl::memory::format_tag::tnc</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_dst_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">dec_dst_iter_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab49be97ff353a86d84d06d98f846b61d"><span class="std std-ref">dnnl::memory::format_tag::ldnc</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_dst_iter_c_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">dec_dst_iter_c_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fab49be97ff353a86d84d06d98f846b61d"><span class="std std-ref">dnnl::memory::format_tag::ldnc</span></a><span></span><span class="p">);</span>
    <span class="c1">//[dec mem desc]</span>
    <span class="c1">//[create dec memory]</span>
    <span class="k">auto</span> <span class="n">user_dec_wei_layer_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_dec_wei_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_dec_wei_layer</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_dec_wei_iter_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span>
            <span class="n">user_dec_wei_iter_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_dec_wei_iter</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_dec_bias_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">user_dec_bias_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_dec_bias</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">user_dec_dst_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">dec_dst_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">,</span> <span class="n">user_dec_dst</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">dec_src_layer_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">dec_src_layer_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_dst_iter_c_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">dec_dst_iter_c_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="c1">//[create dec memory]</span>

    <span class="k">auto</span> <span class="n">dec_wei_layer_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_dec_wei_layer_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">dnnl::memory::format_tag::any</span></a><span></span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_wei_iter_md</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc"><span class="std std-ref">dnnl::memory::desc</span></a><span></span><span class="p">({</span><span class="n">user_dec_wei_iter_dims</span><span class="p">},</span>
            <a class="reference internal" href="enum_dnnl_memory_data_type.html#doxid-structdnnl-1-1memory-1a8e83474ec3a50e08e37af76c8c075dcea512dc597be7ae761876315165dc8bd2e"><span class="std std-ref">dnnl::memory::data_type::f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_memory_format_tag.html#doxid-structdnnl-1-1memory-1a8e71077ed6a5f7fb7b3e6e1a5a2ecf3fa100b8cad7cf2a56f6df78f171f97a1ec"><span class="std std-ref">dnnl::memory::format_tag::any</span></a><span></span><span class="p">);</span>

    <span class="c1">// As mentioned above, we create a view without context out of the</span>
    <span class="c1">// memory with context.</span>
    <span class="c1">//[create noctx mem]</span>
    <span class="k">auto</span> <span class="n">dec_dst_iter_memory</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">dnnl::memory</span></a><span></span><span class="p">(</span><span class="n">dec_dst_iter_md</span><span class="p">,</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_dst_iter_noctx_md</span> <span class="o">=</span> <span class="n">dec_dst_iter_md</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc-1a7de2abef3b34e94c5dfa16e1fc3f3aab"><span class="std std-ref">submemory_desc</span></a><span></span><span class="p">(</span>
            <span class="n">dec_dst_iter_noctx_dims</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">});</span>
    <span class="c1">//[create noctx mem]</span>

    <span class="c1">// TODO: add support for residual connections</span>
    <span class="c1">// should it be a set residual in pd or a field to set manually?</span>
    <span class="c1">// should be an integer to specify at which layer to start</span>
    <span class="c1">//[create dec rnn]</span>
    <span class="k">auto</span> <span class="n">dec_ctx_prim_desc</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html#doxid-structdnnl-1-1lstm-forward-1-1primitive-desc"><span class="std std-ref">lstm_forward::primitive_desc</span></a><span></span><span class="p">(</span><span class="n">cpu_engine</span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_prop_kind.html#doxid-group-dnnl-api-attributes-1ggac7db48f6583aa9903e54c2a39d65438fa3b9fad4f80d45368f856b5403198ac4c"><span class="std std-ref">prop_kind::forward_inference</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_rnn_direction.html#doxid-group-dnnl-api-rnn-1gga33315cf335d1cbe26fd6b70d956e23d5a04f4bf4bc6a47e30f0353597e244c44a"><span class="std std-ref">rnn_direction::unidirectional_left2right</span></a><span></span><span class="p">,</span> <span class="n">dec_src_layer_md</span><span class="p">,</span>
            <span class="n">dec_dst_iter_md</span><span class="p">,</span> <span class="n">dec_dst_iter_c_md</span><span class="p">,</span> <span class="n">dec_wei_layer_md</span><span class="p">,</span>
            <span class="n">dec_wei_iter_md</span><span class="p">,</span> <span class="n">user_dec_bias_md</span><span class="p">,</span> <span class="n">dec_dst_layer_md</span><span class="p">,</span>
            <span class="n">dec_dst_iter_noctx_md</span><span class="p">,</span> <span class="n">dec_dst_iter_c_md</span><span class="p">);</span>
    <span class="c1">//[create dec rnn]</span>

    <span class="c1">//[reorder weight memory]</span>
    <span class="k">auto</span> <span class="n">dec_wei_layer_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">dec_ctx_prim_desc</span><span class="p">.</span><span class="n">weights_layer_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_wei_layer_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_dec_wei_layer_memory</span><span class="p">,</span> <span class="n">dec_wei_layer_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">dec_wei_layer_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_dec_wei_layer_memory</span><span class="p">,</span> <span class="n">dec_wei_layer_memory</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">dec_wei_iter_memory</span>
            <span class="o">=</span> <a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory"><span class="std std-ref">memory</span></a><span></span><span class="p">(</span><span class="n">dec_ctx_prim_desc</span><span class="p">.</span><span class="n">weights_iter_desc</span><span class="p">(),</span> <span class="n">cpu_engine</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">dec_wei_iter_reorder_pd</span> <span class="o">=</span> <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html#doxid-structdnnl-1-1reorder-1-1primitive-desc"><span class="std std-ref">reorder::primitive_desc</span></a><span></span><span class="p">(</span>
            <span class="n">user_dec_wei_iter_memory</span><span class="p">,</span> <span class="n">dec_wei_iter_memory</span><span class="p">);</span>
    <a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder"><span class="std std-ref">reorder</span></a><span></span><span class="p">(</span><span class="n">dec_wei_iter_reorder_pd</span><span class="p">)</span>
            <span class="p">.</span><a class="reference internal" href="struct_dnnl_reorder.html#doxid-structdnnl-1-1reorder-1ab9d5265274a13d4afa1fe33d784a1027"><span class="std std-ref">execute</span></a><span></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">user_dec_wei_iter_memory</span><span class="p">,</span> <span class="n">dec_wei_iter_memory</span><span class="p">);</span>
    <span class="c1">//[reorder weight memory]</span>

    <span class="c1">//[push rnn to decoder net]</span>
    <span class="c1">// TODO: add a reorder when they will be available</span>
    <span class="n">decoder_net</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_lstm_forward.html#doxid-structdnnl-1-1lstm-forward"><span class="std std-ref">lstm_forward</span></a><span></span><span class="p">(</span><span class="n">dec_ctx_prim_desc</span><span class="p">));</span>
    <span class="n">decoder_net_args</span><span class="p">.</span><span class="n">push_back</span><span class="p">({{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gab91ce4d04cf4e98e3a407daa0676764f"><span class="std std-ref">DNNL_ARG_SRC_LAYER</span></a><span></span><span class="p">,</span> <span class="n">dec_src_layer_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaf35f4f604284f1b00bb35bffd0f7a143"><span class="std std-ref">DNNL_ARG_SRC_ITER</span></a><span></span><span class="p">,</span> <span class="n">dec_dst_iter_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga8ef6969516e717208a33766542410410"><span class="std std-ref">DNNL_ARG_SRC_ITER_C</span></a><span></span><span class="p">,</span> <span class="n">dec_dst_iter_c_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga1ac9e1f1327be3902b488b64bae1b4c5"><span class="std std-ref">DNNL_ARG_WEIGHTS_LAYER</span></a><span></span><span class="p">,</span> <span class="n">dec_wei_layer_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga5a9c39486c01ad263e29677a32735af8"><span class="std std-ref">DNNL_ARG_WEIGHTS_ITER</span></a><span></span><span class="p">,</span> <span class="n">dec_wei_iter_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad0cbc09942aba93fbe3c0c2e09166f0d"><span class="std std-ref">DNNL_ARG_BIAS</span></a><span></span><span class="p">,</span> <span class="n">user_dec_bias_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gacfc123a6a4ff3b4af4cd27ed66fb8528"><span class="std std-ref">DNNL_ARG_DST_LAYER</span></a><span></span><span class="p">,</span> <span class="n">user_dec_dst_layer_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga13b91cbd3f531d9c90227895a275d5a6"><span class="std std-ref">DNNL_ARG_DST_ITER</span></a><span></span><span class="p">,</span> <span class="n">dec_dst_iter_memory</span><span class="p">},</span>
            <span class="p">{</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga8b77d8716fc0ab9923d6cb409dbdf900"><span class="std std-ref">DNNL_ARG_DST_ITER_C</span></a><span></span><span class="p">,</span> <span class="n">dec_dst_iter_c_memory</span><span class="p">}});</span>
    <span class="c1">//[push rnn to decoder net]</span>
    <span class="c1">// allocating temporary buffer for attention mechanism</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">weighted_annotations</span><span class="p">(</span>
            <span class="n">src_seq_length_max</span> <span class="o">*</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="k">auto</span> <a class="reference internal" href="namespace_dnnl_graph_sycl_interop.html#doxid-namespacednnl-1-1graph-1-1sycl-interop-1acc5ff56ff0f276367b047c3c73093a67"><span class="std std-ref">execute</span></a><span></span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">encoder_net</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">encoder_net_args</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
                <span class="o">&amp;&amp;</span> <span class="s">&quot;something is missing&quot;</span><span class="p">);</span>
        <span class="c1">//[run enc]</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">encoder_net</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">p</span><span class="p">)</span>
            <span class="n">encoder_net</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoder_net_args</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
        <span class="c1">//[run enc]</span>

        <span class="c1">//[weight ano]</span>
        <span class="n">compute_weighted_annotations</span><span class="p">(</span><span class="n">weighted_annotations</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                <span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">,</span>
                <span class="n">user_weights_annotation</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">enc_dst_layer_memory</span><span class="p">.</span><span class="n">get_data_handle</span><span class="p">());</span>
        <span class="c1">//[weight ano]</span>

        <span class="c1">//[init src_layer]</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">dec_src_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a24aaca8359e9de0f517c7d3c699a2209"><span class="std std-ref">get_data_handle</span></a><span></span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">dec_src_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1ad8a1ad28ed7acf9c34c69e4b882c6e92"><span class="std std-ref">get_desc</span></a><span></span><span class="p">().</span><a class="reference internal" href="struct_dnnl_memory_desc-2.html#doxid-structdnnl-1-1memory-1-1desc-1abfa095ac138d4d2ef8efd3739e343f08"><span class="std std-ref">get_size</span></a><span></span><span class="p">());</span>
        <span class="c1">//[init src_layer]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dim_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tgt_seq_length_max</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">float</span> <span class="o">*</span><span class="n">src_att_layer_handle</span>
                    <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">dec_src_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a24aaca8359e9de0f517c7d3c699a2209"><span class="std std-ref">get_data_handle</span></a><span></span><span class="p">();</span>
            <span class="kt">float</span> <span class="o">*</span><span class="n">src_att_iter_handle</span>
                    <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">dec_dst_iter_memory</span><span class="p">.</span><span class="n">get_data_handle</span><span class="p">();</span>

            <span class="c1">//[att ctx]</span>
            <span class="n">compute_attention</span><span class="p">(</span><span class="n">src_att_iter_handle</span><span class="p">,</span> <span class="n">src_seq_length_max</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span>
                    <span class="n">feature_size</span><span class="p">,</span> <span class="n">user_weights_attention_src_layer</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                    <span class="n">src_att_layer_handle</span><span class="p">,</span>
                    <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">enc_bidir_dst_layer_memory</span><span class="p">.</span><span class="n">get_data_handle</span><span class="p">(),</span>
                    <span class="n">weighted_annotations</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                    <span class="n">user_weights_alignments</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="c1">//[att ctx]</span>

            <span class="c1">//[cp ctx]</span>
            <span class="n">copy_context</span><span class="p">(</span>
                    <span class="n">src_att_iter_handle</span><span class="p">,</span> <span class="n">dec_n_layers</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">);</span>
            <span class="c1">//[cp ctx]</span>

            <span class="n">assert</span><span class="p">(</span><span class="n">decoder_net</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">decoder_net_args</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
                    <span class="o">&amp;&amp;</span> <span class="s">&quot;something is missing&quot;</span><span class="p">);</span>
            <span class="c1">//[run dec iter]</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">decoder_net</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">p</span><span class="p">)</span>
                <span class="n">decoder_net</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">decoder_net_args</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
            <span class="c1">//[run dec iter]</span>

            <span class="c1">//[set handle]</span>
            <span class="k">auto</span> <span class="n">dst_layer_handle</span>
                    <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">user_dec_dst_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a24aaca8359e9de0f517c7d3c699a2209"><span class="std std-ref">get_data_handle</span></a><span></span><span class="p">();</span>
            <span class="n">dec_src_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a34d1c7dbe9c6302b197f22c300e67aed"><span class="std std-ref">set_data_handle</span></a><span></span><span class="p">(</span><span class="n">dst_layer_handle</span><span class="p">);</span>
            <span class="n">user_dec_dst_layer_memory</span><span class="p">.</span><a class="reference internal" href="struct_dnnl_memory-2.html#doxid-structdnnl-1-1memory-1a34d1c7dbe9c6302b197f22c300e67aed"><span class="std std-ref">set_data_handle</span></a><span></span><span class="p">(</span>
                    <span class="n">dst_layer_handle</span> <span class="o">+</span> <span class="n">batch</span> <span class="o">*</span> <span class="n">feature_size</span><span class="p">);</span>
            <span class="c1">//[set handle]</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Parameters:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; batch = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">batch</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; feature size = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">feature_size</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; maximum source sequence length = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">src_seq_length_max</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; maximum target sequence length = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tgt_seq_length_max</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; number of layers of the bidirectional encoder = &quot;</span>
              <span class="o">&lt;&lt;</span> <span class="n">enc_bidir_n_layers</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; number of layers of the unidirectional encoder = &quot;</span>
              <span class="o">&lt;&lt;</span> <span class="n">enc_unidir_n_layers</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
              <span class="o">&lt;&lt;</span> <span class="s">&quot; number of layers of the decoder = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">dec_n_layers</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <a class="reference internal" href="namespace_dnnl_graph_sycl_interop.html#doxid-namespacednnl-1-1graph-1-1sycl-interop-1acc5ff56ff0f276367b047c3c73093a67"><span class="std std-ref">execute</span></a><span></span><span class="p">();</span>
    <span class="n">s</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">handle_example_errors</span><span class="p">({</span><a class="reference internal" href="enum_dnnl_engine_kind.html#doxid-structdnnl-1-1engine-1a2635da16314dcbdb9bd9ea431316bb1aad9747e2da342bdb995f6389533ad1a3d"><span class="std std-ref">engine::kind::cpu</span></a><span></span><span class="p">},</span> <span class="n">simple_net</span><span class="p">);</span>
<span class="p">}</span></pre>
</section>


              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2016-2022 Intel Corporation.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>